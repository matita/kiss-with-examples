<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>KISS explained</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">

    <style>
      .reveal blockquote p {
        text-align: left;
        margin-left: 20px;
        margin-right: 20px;
        display: block!important;
      }
      .reveal blockquote cite {
        display: block;
        text-align: right;
      }
      .reveal .hljs td {
        font-size: .8em;
        line-height: 1.1;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h2>UX of code</h2>
          <h2>+</h2>
          <h2>KISS explained</h2>

          <p>by Matteo Colucci</p>
          <small>Press &lt;space&gt; to continue, Shift + &lt;space&gt; to go back</small>
        </section>

        <section id="ux-of-code">
          <section>
            <h2>UX of code</h2>
          </section>

          <section>
            <blockquote>
              <p>Any sufficiently advanced technology is indistinguishable from magic.</p>
              <p><cite>– Arthur C. Clarke</cite></p>
            </blockquote>
          </section>

          <section>
            Non-devs might think software is actually magic
          </section>

          <section>
            <blockquote>
              <p>Wizards don't believe in magic.</p>
              <p><cite>– Matteo Colucci</cite></p>
            </blockquote>

            <small class="fragment">I could talk for hours about this pointless nerdy topic, feel free to hit me up ;)</small>
          </section>

          <section>
            Devs know how to speak to machines
          </section>

          <section>
            <blockquote>
              <p>With great power comes great responsibility.</p>
              <p><cite>– Uncle Ben</cite></p>
            </blockquote>
          </section>

          <section>
            <p>Devs are interpreters between users and machines</p>
            <p class="fragment">Devs are users of other devs' code</p>
            <p class="fragment">Devs are interpreters between machines and other devs</p>
          </section>

          <section>
            <ul>
              <li>Maintainable code &gt; performant code</li>
              <ul>
                <li class="fragment">we work in a team with different levels of expertise</li>
                <li class="fragment">specs change constantly (sometimes rapidly)</li>
                <li class="fragment">compilers optimize code</li>
              </ul>
              <li class="fragment">otherwise we'll all be writing ASM</li>
            </ul>
          </section>
        </section>

        <section id="kiss">
          <section>
            <h2>KISS principle</h2>
            <p>Keep It Simple, Stupid</p>
          </section>

          <section>
            <blockquote>
              <p>Complicating is easy, simplifying is difficult.</p>
              <p><cite>- Bruno Munari</cite></p>
            </blockquote>
          </section>

          <section>
            <p>5 corollaries of KISS</p>
            <small>with real-life examples</small>
          </section>

          <section>
            <p>Premises:</p>
            <ul>
              <li class="fragment">
                We'll see "bad code" examples
                <ul>
                  <li class="fragment">there's no right way<span class="fragment">, but there are wrong ways</span></li>
                  <li class="fragment">it's easier to understand what's wrong than how right should be</li>
                  <li class="fragment">there's no point in blaming devs</li>
                  <li class="fragment">assumption then might be different than now</li>
                </ul>
              </li>
              <li class="fragment">
                <q>Perfect is the enemy of good</q>
                <ul>
                  <li>bad code that works now<br>is better than<br>perfect code that will work in months</li>
                </ul>
              </li>
              <li class="fragment">It's just my opinion</li>
            </ul>
          </section>
        </section>

        <section id="avoid-abstractions">
          <section>
            <h2>Avoid abstraction if not needed</h2>
          </section>

          <section data-auto-animate>
            <p>TCF library returns an object when invoking <code>getTCData</code> and <code>addEventListener</code></p>
            <pre data-id="tcdata"><code><script type="text/template">
              {
                cmpId: 123,
                tcString: 'asdfasdfasdf',
                outOfBand: {},
                ...
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>To support Google we had to add a property <code>addtlConsent</code></p>
            <pre data-id="tcdata"><code><script type="text/template">
              {
                cmpId: 123,
                tcString: 'asdfasdfasdf',
                outOfBand: {},
                ...
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>To support Google we had to add a property <code>addtlConsent</code></p>
            <pre data-id="tcdata"><code><script type="text/template">
              {
                cmpId: 123,
                tcString: 'asdfasdfasdf',
                outOfBand: {},
                addtlConsent: '1~1.3.4',
                ...
              }
            </script></code></pre>
          </section>

          <section data-transition="fade">
            <p>TCF library allows to change the value with middlewares</p>
            <pre data-id="process-data"><code><script type="text/template">
              const cmpApi = new CmpApi({
                getTCData: addAcmString,
                addEventListener: addAcmString,
              });

              function addAcmString(next, tcData, success) {
                if (tcData && acmString) {
                  tcData.addtlConsent = acmString;
                }

                if (typeof next === 'function') {
                  next(tcData, success);
                } else {
                  console.error('next is not a function')
                }
              };
            </script></code></pre>
          </section>

          <section>
            <p>Then we had to remove <code>outOfBand</code> section in some conditions</p>
          </section>

          <section data-transition="fade">
            <p>The proposal</p>
            <pre data-id="process-data"><code><script type="text/template">
              const cmpApi = new CmpApi({
                getTCData: processData,
                addEventListener: processData,
              });

              const processData = use(
                defaultMiddleware,
                addAcmString,
                removeOutOfBand,
              );

              function use(...middlewares) {
                return function combinedMiddlewares(next, ...params) {
                  const fn = middlewares.reduce((prev, cur) => (
                    cur.bind(this, prev)
                  ), next);

                  return fn.apply(this, params);
                }
              };

              function defaultMiddleware(next, tcData, success) {
                if (typeof next === 'function') {
                  next(tcData, success);
                } else {
                  console.error('next is not a function');
                }
              };

              function addAcmString(next, tcData, success) {
                if (tcData && acmString) {
                  tcData.addtlConsent = acmString;
                }
                next(tcData, success);
              };

              function removeOutOfBand(next, tcData, success) {
                if (isServiceSpecific && tcData) {
                  delete tcData.outOfBand;
                }
                next(tcData, success);
              };
            </script></code></pre>
          </section>

          <section>
            <h3>Why it's bad</h3>
            <ul>
              <li class="fragment">It's clever<span class="fragment"> but too clever</span></li>
              <li class="fragment">
                It adds a layer of abstraction
                <ul>
                  <li class="fragment">harder to read</li>
                  <li class="fragment">harder to debug</li>
                  <li class="fragment">
                    harder to understand for unexperienced devs
                    <ul>
                      <li class="fragment">executes combined functions in reverse order</li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="fragment">
                It's too much code
                <ul>
                  <li class="fragment">not necessarily bad, but here it is since...</li>
                </ul>
              </li>
              <li class="fragment">
                It's not needed
                <ul>
                  <li class="fragment">middlewares are good for external devs</li>
                  <li class="fragment">but we're in control of all the code</li>
                </ul>
              </li>
            </ul>
          </section>

          <section data-transition="fade">
            <p>The result</p>
            <pre data-id="process-data"><code><script type="text/template">
              const cmpApi = new CmpApi({
                getTCData: processData,
                addEventListener: processData,
              });

              function processData(next, tcData, success) {
                addAcmString(tcData);
                removeOutOfBand(tcData);
                if (typeof next === 'function') {
                  next(tcData, success);
                } else {
                  console.error('next is not a function');
                }
              };

              function addAcmString(tcData) {
                if (tcData && acmString) {
                  tcData.addtlConsent = acmString;
                }
              };

              function removeOutOfBand(tcData) {
                if (isServiceSpecific && tcData) {
                  delete tcData.outOfBand;
                }
              };
            </script></code></pre>
          </section>

          <section>
            <h2>Avoid abstraction if not needed</h2>
          </section>
        </section>

        <section id="separate-actions">
          <section>
            <h2>Logically (and graphically) separate actions</h2>
            <p>(mostly if they're in if...else)</p>
          </section>

          <section>
            <pre><code>
              floatingPreferencesButtonCaption: true
            </code></pre>
            <p>English</p>
            <img src="http://matteo.colucci.s3.iubenda.com/Screen-Shot-2020-10-11-17-38-48.png">
            <p>Italian</p>
            <img src="http://matteo.colucci.s3.iubenda.com/Screen-Shot-2020-10-11-17-41-08.png">
          </section>

          <section>
            <pre><code>
              floatingPreferencesButtonCaption: 'Privacy'
            </code></pre>
            <img src="http://matteo.colucci.s3.iubenda.com/Screen-Shot-2020-10-11-17-42-23.png">
          </section>

          <section>
            <pre><code>
              floatingPreferencesButtonCaption: false // (default)
            </code></pre>
            <img src="http://matteo.colucci.s3.iubenda.com/Screen-Shot-2020-10-11-17-37-26.png">
          </section>

          <section>
            <p>First code proposal</p>
            <pre><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption'));
              }
            </script></code></pre>
          </section>

          <section>
            <p>Why it's bad:</p>
            <p class="fragment">if this <u>do this</u> otherwise <u>do that</u></p>
            <p class="fragment">but</p>
            <p class="fragment">do this == do that == display a label</p>
          </section>

          <section data-auto-animate>
            <p>How it could be:</p>
            <pre data-id="caption"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              }

              if (caption) {
                floatingBtn.setAttribute('data-tp-label', caption);
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>So we have two clearly separated sections/actions:</p>
            <pre data-id="caption"><code data-line-numbers="1-7|9-12"><script type="text/template">
              // Get the caption
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              }

              // Display the caption
              if (caption) {
                floatingBtn.setAttribute('data-tp-label', caption);
              }
            </script></code></pre>
          </section>

          <section>
            <h2>Logically (and graphically) separate actions</h2>
            <p>(mostly if they're in if...else)</p>
          </section>
        </section>

        <section id="broken-window-theory">
          <section>
            <h2>The broken window theory</h2>
          </section>

          <section>
            <p>Why rejecting PR for something that small?</p>
          </section>

          <section>
            <blockquote>
              <p>If a window in a building is broken and is left unrepaired, all the rest of the windows will soon be broken.</p>
              <p><cite>- <a href="https://en.wikipedia.org/wiki/Broken_windows_theory">Wikipedia article</a></cite></p>
            </blockquote>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption'));
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption() + '!');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption() + '!');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.setAttribute('data-tp-label', caption + '!');
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '!');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '!');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.setAttribute('data-tp-label', caption + '!');
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '?');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '?');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.setAttribute('data-tp-label', caption + '!');
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '?');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '?');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.setAttribute('data-tp-label', caption + '?');
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
              <li>we want to change button markup?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.setAttribute('data-tp-label', options.floatingPreferencesButtonCaption + '?');
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.setAttribute('data-tp-label', t('floating_preferences_button.caption') + '?');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.setAttribute('data-tp-label', caption + '?');
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
              <li>we want to change button markup?</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.innerHTML = '<span>' + options.floatingPreferencesButtonCaption + '?</span>';
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.innerHTML = '<span>' + t('floating_preferences_button.caption') + '?</span>';
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.innerHTML = '<span>' caption + '?</span>';
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
              <li>we want to change button markup?</li>
            </ul>
            <pre data-id="caption-designed"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              }

              if (caption) {
                floatingBtn.setAttribute('data-tp-label', caption);
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if...</p>
            <ul>
              <li>we want to add a "!" at the end of the caption?</li>
              <li>customers could specify a function?</li>
              <li>the function could return empty string?</li>
              <li>[URGENT] we want "?" instead of "!"?</li>
              <li>we want to change button markup?</li>
            </ul>
            <pre data-id="caption-designed"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                caption = options.floatingPreferencesButtonCaption();
              }

              if (caption) {
                floatingBtn.innerHTML = '<span>' + caption + '?</span>');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>You might think that because of DRY you could wrap the displaying in a function</p>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                floatingBtn.innerHTML = '<span>' + options.floatingPreferencesButtonCaption + '?</span>';
              } else if (options.floatingPreferencesButtonCaption === true) {
                floatingBtn.innerHTML = '<span>' + t('floating_preferences_button.caption') + '?</span>';
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  floatingBtn.innerHTML = '<span>' caption + '?</span>';
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>You might think that because of DRY you could wrap the displaying in a function</p>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                displayCaption(options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                displayCaption(t('floating_preferences_button.caption'));
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  displayCaption(caption);
                }
              }

              function displayCaption(caption) {
                floatingBtn.innerHTML = '<span>' caption + '?</span>';
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>But you ARE repeating <code>displayCaption</code></p>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                displayCaption(options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                displayCaption(t('floating_preferences_button.caption'));
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  displayCaption(caption);
                }
              }

              function displayCaption(caption) {
                floatingBtn.innerHTML = '<span>' caption + '?</span>';
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if you had to expose an API:</p>
            <ul>
              <li class="fragment">before displayCaption if any</li>
              <li class="fragment">with true if a caption is shown</li>
              <li class="fragment">with false if a caption is not shown</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                displayCaption(options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                displayCaption(t('floating_preferences_button.caption'));
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  displayCaption(caption);
                }
              }

              function displayCaption(caption) {
                floatingBtn.innerHTML = '<span>' caption + '?</span>';
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>What if you had to expose an API:</p>
            <ul>
              <li>before displayCaption if any</li>
              <li>with true if a caption is shown</li>
              <li>with false if a caption is not shown</li>
            </ul>
            <pre data-id="caption"><code><script type="text/template">
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                updateSomeApi(true);
                displayCaption(options.floatingPreferencesButtonCaption);
              } else if (options.floatingPreferencesButtonCaption === true) {
                updateSomeApi(true);
                displayCaption(t('floating_preferences_button.caption'));
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                var caption = options.floatingPreferencesButtonCaption();
                if (caption) {
                  updateSomeApi(true);
                  displayCaption(caption);
                } else {
                  updateSomeApi(false);
                }
              } else {
                updateSomeApi(false);
              }

              function displayCaption(caption) {
                floatingBtn.innerHTML = '<span>' caption + '?</span>';
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>If it was already well designed:</p>
            <pre data-id="caption-designed"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                caption = options.floatingPreferencesButtonCaption();
              }

              if (caption) {
                floatingBtn.innerHTML = '<span>' + caption + '?</span>');
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>If it was already well designed:</p>
            <pre data-id="caption-designed"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                caption = options.floatingPreferencesButtonCaption();
              }

              if (caption) {
                updateSomeApi(true);
                floatingBtn.innerHTML = '<span>' + caption + '?</span>');
              } else {
                updateSomeApi(false);
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>Or better:</p>
            <pre data-id="caption-designed"><code><script type="text/template">
              var caption;
              if (typeof options.floatingPreferencesButtonCaption === 'string') {
                caption = options.floatingPreferencesButtonCaption;
              } else if (options.floatingPreferencesButtonCaption === true) {
                caption = t('floating_preferences_button.caption');
              } else if (typeof options.floatingPreferencesButtonCaption === 'function') {
                caption = options.floatingPreferencesButtonCaption();
              }

              updateSomeApi(!!caption);
              if (caption) {
                floatingBtn.innerHTML = '<span>' + caption + '?</span>');
              }
            </script></code></pre>
          </section>

          <section>
            <h2>Logically (and graphically) separate actions</h2>
            <p>(mostly if they're in if...else)</p>
            <h2 class="fragment">Broken window theory</h2>
          </section>
        </section>

        <section id="keep-it-linear">
          <section><h2>Keep it linear</h2></section>

          <section>
            <p>What does CS do:</p>
            <ul>
              <li class="fragment">shows a banner if user didn't express preferences</li>
              <li class="fragment">activates scripts if user expressed preferences</li>
            </ul>
          </section>

          <section>
            <p>Let's search for the code to show the banner:</p>
            <pre><code><script type="text/template">
              document.body.appendChild(banner);
            </script></code></pre>
            <p class="fragment">Warning: the following is mostly pseudo code</p>
          </section>

          <section>
            <p>boot.js</p>
            <pre><code data-line-numbers="1-8|4,7|10-14|13"><script type="text/template">
              getConfigurationWithDefaults();
              if (isTcfEnabled()) {
                loadTcfLib(function() {
                  createInstance(options);
                });
              } else {
                createInstance(options);
              }

              function createInstance(options) {
                _iub.cs = new CookieSolution(options);
                var remoteConf = loadRemoteConfig(_iub.cs);
                _iub.cs.preLoad();
              }
            </script></code></pre>
          </section>

          <section>
            <p>iubenda_cookie_solution.js</p>
            <pre><code data-line-numbers="4-16|15"><script type="text/template">
              function CookieSolution(options) {
                // ...

                this.preLoad = function() {
                  if (isBrowserNotSupported()) {
                    return;
                  }

                  if (isBot()) {
                    return applyConsent(true);
                  }

                  loadCcpaConsent();
                  loadTcfConsent();
                  loadLocalConsent();
                };
              }
            </script></code></pre>
          </section>

          <section>
            <p>cookie.js</p>
            <pre><code data-line-numbers="|4-5|7"><script type="text/template">
              function loadLocalConsent() {
                var consent = loadLocalCookie('_iub_cs-' + cookiePolicyId);
                if (consent) {
                  _iub.cs.consent = consent;
                  _iub.cs.start();
                } else {
                  loadRemoteConsent();
                }
              }
            </script></code></pre>
          </section>

          <section>
            <p>cookie.js</p>
            <pre><code data-line-numbers="|6"><script type="text/template">
              function loadRemoteConsent() {
                var consent = loadRemoteCookie('_iub_cs-' + cookiePolicyId);
                if (consent) {
                  _iub.cs.consent = consent;
                }
                _iub.cs.start();
              }
            </script></code></pre>
          </section>

          <section>
            <p>iubenda_cookie_solution.js</p>
            <pre><code data-line-numbers="4-11|7"><script type="text/template">
              function CookieSolution(options) {
                // ...

                this.start = function() {
                  tracker.start();
                  if (somePreferencesAreMissing()) {
                    ui.start();
                  } else {
                    activateBlockedScripts();
                  }
                };
              }
            </script></code></pre>
          </section>

          <section>
            <p>ui.js</p>
            <pre><code data-line-numbers="6-14|9|4"><script type="text/template">
              function UI() {
                // ...

                this.setUpBanner = _iub.bannerRenderer.bind(this);

                this.start = function() {
                  if (somePreferencesAreMissing()) {
                    this.bindBannerEvents();
                    this.setUpBanner();
                  }

                  this.bindOtherEvents();
                  cs.csReady();
                };
              }
            </script></code></pre>
          </section>

          <section>
            <p>banner_renderer.js</p>
            <pre><code data-line-numbers="|3"><script type="text/template">
              _iub.bannerRenderer = function() {
                var banner = createBannerDomElement();
                document.body.appendChild(banner);
              };
            </script></code></pre>
          </section>

          <section>
            <p>So we have a nested behaviour:</p>
            <ul class="fragment">
              <li>
                boot.js :: init
                <ul class="fragment">
                  <li>
                    boot.js :: createInstance
                    <ul class="fragment">
                      <li>
                        iubenda_cookie_solution.js :: preLoad
                        <ul class="fragment">
                          <li>
                            cookie.js :: loadLocalConsent
                            <ul class="fragment">
                              <li>iubenda_cookie_solution.js :: start</li>
                              <li>
                                cookie.js :: loadRemoteConsent
                                <ul class="fragment">
                                  <li>
                                    iubenda_cookie_solution.js :: start
                                    <ul>
                                      <li class="fragment">
                                        ui.js :: start
                                        <ul>
                                          <li class="fragment">banner_renderer.js :: bannerRenderer</li>
                                        </ul>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <p>Why it's bad:</p>
            <ul>
              <li class="fragment">a single function does a lot of things</li>
              <li class="fragment">their name is a lie</li>
              <li class="fragment">you have to read the whole code to know what's going on</li>
              <li class="fragment">modules don't have a clear hierarchy</li>
              <li class="fragment">modules change properties of other modules</li>
              <li class="fragment">changing order of things is hard</li>
            </ul>
          </section>

          <section>
            <p>How it could be:</p>
            <pre><code><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section><h2>Keep it linear</h2></section>
        </section>

        <section id="pseudo-pseudo-code">
          <section>
            <h2>Use pseudo-pseudo-code</h2>
          </section>

          <section>
            <p>The possible CS refactor was pseudo-code:</p>
            <pre class="fragment"><code><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <ul>
              <li>Readable: almost plain English</li>
              <li>Structured: has programming constructs (<code>if</code>...)</li>
              <li>Understandable: doesn't have implementation details</li>
              <li>Searchable: it's like a ToC</li>
            </ul>
            <pre data-id="cs-refactored"><code><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>Let's change it into pseudo-pseudo (aka actual) code</p>
            <pre data-id="cs-refactored"><code data-line-numbers="|2"><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate="">
            <pre data-id="getConfigurationWithDefaults"><code><script type="text/template">
              function getConfigurationWithDefaults() {
                return deepMerge({}, defaults, options);
              }
            </script></code></pre>
          </section>

          <section data-auto-animate="">
            <pre data-id="getConfigurationWithDefaults"><code><script type="text/template">
              var obj = _iub.jlib.obj;
              var defaults = { ... };

              function getConfigurationWithDefaults(options) {
                return obj.deepMerge({}, defaults, options);
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="cs-refactored"><code data-line-numbers="2"><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="cs-refactored"><code data-line-numbers="2|3"><script type="text/template">
              function init() {
                var options = getConfigurationWithDefaults(_iub.csConfiguration);
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code><script type="text/template">
              function loadDependencies() {
                if (isTcEnabled()) {
                  loadTcfLib();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code><script type="text/template">
              function loadDependencies() {
                if (options.enableTcf) {
                  loadTcfLib();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code><script type="text/template">
              function loadDependencies(options) {
                if (options.enableTcf) {
                  loadTcfLib();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code><script type="text/template">
              var TCF_LIB_URL = '//cdn.iubenda.com/cs/tcf/tcf-v2.js';

              function loadDependencies(options) {
                if (options.enableTcf) {
                  loadScript(TCF_LIB_URL);
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code data-line-numbers="9-16"><script type="text/template">
              var TCF_LIB_URL = '//cdn.iubenda.com/cs/tcf/tcf-v2.js';

              function loadDependencies(options) {
                if (options.enableTcf) {
                  loadScript(TCF_LIB_URL);
                }
              }

              function loadScript(url) {
                return new Promise(function(resolve) {
                  var s = document.createElement('script');
                  s.src = url;
                  s.onload = resolve;
                  document.head.appendChild(s);
                });
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="loadDependencies"><code data-line-numbers="3-9"><script type="text/template">
              var TCF_LIB_URL = '//cdn.iubenda.com/cs/tcf/tcf-v2.js';

              function loadDependencies(options) {
                if (options.enableTcf) {
                  return loadScript(TCF_LIB_URL);
                }

                return Promise.resolve();
              }

              function loadScript(url) {
                return new Promise(function(resolve) {
                  var s = document.createElement('script');
                  s.src = url;
                  s.onload = resolve;
                  document.head.appendChild(s);
                });
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="cs-refactored"><code data-line-numbers="3"><script type="text/template">
              function init() {
                var options = getConfigurationWithDefaults(_iub.csConfiguration);
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <pre data-id="cs-refactored"><code data-line-numbers="3"><script type="text/template">
              function init() {
                var options = getConfigurationWithDefaults(_iub.csConfiguration);
                loadDependencies(options).then(function() {
                  loadPreferences();
                  if (somePreferencesAreMissing()) {
                    showBanner();
                  } else {
                    activateBlockedScripts();
                  }
                });
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>Fast forward...:</p>
            <pre data-id="cs-refactored"><code><script type="text/template">
              function init() {
                var options = getConfigurationWithDefaults(_iub.csConfiguration);
                loadDependencies(options).then(function() {
                  loadPreferences(options).then(function(preferences) {
                    if (somePreferencesAreMissing(preferences, options)) {
                      showBanner(options);
                    } else {
                      activateBlockedScripts(preferences, options);
                    }
                  });
                });
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>If we go back to pseudo-code:</p>
            <pre data-id="cs-refactored"><code><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>
        </section>

        <section id="use-es6">
          <section>
            <h2>Use ES6?</h2>
          </section>

          <section data-auto-animate>
            <p>Pseudo-code:</p>
            <pre data-id="cs-refactored"><code><script type="text/template">
              function init() {
                getConfigurationWithDefaults();
                loadDependencies();
                loadPreferences();
                if (somePreferencesAreMissing()) {
                  showBanner();
                } else {
                  activateBlockedScripts();
                }
              }
            </script></code></pre>
          </section>

          <section data-auto-animate>
            <p>Actual code:</p>
            <pre data-id="cs-refactored"><code><script type="text/template">
              async function init() {
                const options = getConfigurationWithDefaults(_iub.csConfiguration);
                await loadDependencies(options);
                const preferences = await loadPreferences(options);
                if (somePreferencesAreMissing(preferences, options)) {
                  showBanner(options);
                } else {
                  activateBlockedScripts(preferences, options);
                }
              }
            </script></code></pre>
          </section>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      document.querySelectorAll('code').forEach(function(code) {
        code.classList.add('js');
        code.setAttribute('data-trim', true);
        if (!code.getAttribute('data-line-numbers')) {
          code.setAttribute('data-line-numbers', true);
        }
      });

      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
      });
    </script>
  </body>
</html>
